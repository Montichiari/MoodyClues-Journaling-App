package com.moodyclues.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.moodyclues.dto.CounsellorLinkRequestDto;
import com.moodyclues.model.LinkRequest;
import com.moodyclues.service.CounsellorService;
import com.moodyclues.service.LinkRequestService;

import jakarta.servlet.http.HttpSession;

@RestController
@RequestMapping("/api/linkrequest")
public class LinkRequestController {

	@Autowired
	LinkRequestService linkService;
	
	@Autowired
	CounsellorService cService;
	
    @PostMapping
    public ResponseEntity<?> create(@RequestBody CounsellorLinkRequestDto request, HttpSession session) {
        String counsellorId = (String) session.getAttribute("id");
        LinkRequest linkRequest = linkService.createNewRequest(counsellorId, request.getClientEmail());
        return new ResponseEntity<LinkRequest>(linkRequest, HttpStatus.OK);
    }

	
	@GetMapping("/counsellor/all-link-requests")
	public ResponseEntity<?> allLinkRequests(HttpSession session) {
		
		String id = (String) session.getAttribute("id");
		
		List<LinkRequest> linkRequests = linkService.getAllLinkRequestsByCounsellorId(id);
		
		return new ResponseEntity<>(linkRequests, HttpStatus.OK);
		
	}
	
    @GetMapping("/journal")
    public List<LinkRequest> incoming(HttpSession session) {
        String journalUserId = (String) session.getAttribute("id");
        
        return linkService.listIncoming(journalUserId);
    }

    @PostMapping("/{id}/decision")
    public ResponseEntity<Void> decide(@PathVariable String id,
                                       @RequestBody DecisionDto dto,
                                       HttpSession session) {
        String journalUserId = (String) session.getAttribute("id");
        service.decide(journalUserId, id, dto.isApprove());
        return ResponseEntity.ok().build();
    }
	
	
	
}
